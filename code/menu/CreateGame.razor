@using Sandbox;
@using Sandbox.UI;
@using System;
@using System.Collections.Generic;
@inherits Panel
@namespace Ricochet.Menu
@attribute [StyleSheet]

<root class="root">
    <div class="createGameBox outerBorder">
        <label class="popupText">Create Server</label>
        <div class="inner outerBorder">
			<div class="row">
				<label>Map</label>
				<DropDown class="innerBorder" Value:bind=@Map Options=@MapOptions></DropDown>
			</div>
			<div class="row">
				<label>Hostname</label>
				<TextEntry class="innerBorder" Value:bind="@Hostname"></TextEntry>
			</div>
			<div class ="row">
				<label>Max Players</label>
				<TextEntry class="innerBorder" Value:bind="@MaxPlayers" Numeric="@true"></TextEntry>
			</div>
        </div>
        <div class="buttonRow">
            <button class="outerBorder" onclick="@Start">Start</button>
            <button class="outerBorder" onclick="@Cancel">Cancel</button>
        </div>
    </div>
</root>

@code
{
	Random rand = new Random();
	List<Option> MapOptions = new() {
		new Option( "< Random Map >", "" ),
		new Option( "rc_arena", "lambdagaming.rc_arena" ),
		new Option( "rc_deathmatch", "lambdagaming.rc_deathmatch" ),
		new Option( "rc_deathmatch2", "lambdagaming.rc_deathmatch_2" )
	};

	public string Map { get; set; }
	public string Hostname { get; set; }
	public int MaxPlayers { get; set; }
	public int RoundType { get; set; }
	public int PlayersPerTeam { get; set; }
	public int ArenaRounds { get; set; }
	public bool AllowVR { get; set; }

	public void Cancel() => this.Navigate( "/" );

	public async void Start()
	{
		string finalMap = Map;
		if ( string.IsNullOrWhiteSpace( Map ) )
			finalMap = ( string ) MapOptions[rand.Next( MapOptions.Count )].Value;

		var lobby = await Game.Menu.CreateLobbyAsync( MaxPlayers );
		string name = string.IsNullOrWhiteSpace( Hostname ) ? $"{lobby.Owner.Name}'s Ricochet server" : Hostname;
		lobby.Title = name;
		lobby.Map = finalMap;
		//lobby.ConVars.Add( "rc_roundtype", RoundType );
		//lobby.ConVars.Add( "rc_playersperteam", PlayersPerTeam );
		//lobby.ConVars.Add( "rc_rounds", ArenaRounds );
		//lobby.ConVars.Add( "rc_allowvr", AllowVR );
		_ = lobby.LaunchGameAsync();
	}
}
